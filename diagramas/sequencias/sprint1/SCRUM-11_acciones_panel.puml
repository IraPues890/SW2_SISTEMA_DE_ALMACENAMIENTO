@startuml SCRUM_11_AccionesPanel
title "SCRUM-11 - Acciones en el panel (descargar, compartir, mover, más)"
skinparam monochrome true
actor Usuario as "Usuario / Navegador"
participant "Frontend App" as Frontend
participant "API Backend\n(Express)" as Backend
participant "FileController" as Controller
participant "FileService" as Service
participant "StorageRepository" as Repo
participant "DB (Postgres)" as DB

Usuario -> Frontend: Selecciona uno o varios archivos
Usuario -> Frontend: Pulsa botón 'Acciones' -> elige 'Descargar'
Frontend -> Backend: POST /api/files/batch-download (ids[])
Backend -> Controller: prepareBatchDownload(ids)
Controller -> Service: gatherFiles(ids, userId)
Service -> DB: SELECT archivos y versiones para ids
DB --> Service: metadata
Service -> Repo: (si nube) obtener pre-signed / descargar buffers
Repo -> Storage: (S3/GCP/Azure) obtener objetos o presigns
Repo --> Service: buffers / URLs
Service --> Controller: package/stream (zip o redirect)
Controller --> Frontend: 200 OK (zip stream o descarga iniciada)

note over Frontend,Backend: Otras acciones: compartir (crear permiso), mover a carpeta, renombrar
@enduml
@startuml SCRUM-11_AccionesPanel
title SCRUM-11: Acciones básicas en panel

actor Usuario
participant "Plataforma web" as Frontend
participant "Backend / API" as Backend
participant "Storage Provider" as Storage

Usuario -> Frontend: 1. Seleccionar acción (e.g., renombrar)
activate Usuario
Usuario -> Frontend: 1. Seleccionar acción (e.g., renombrar)
activate Frontend
Frontend -> Backend: 2. PUT /storage/:provider/object?action=rename {oldName,newName}
activate Backend
Backend -> Storage: 3. Ejecutar rename/move
activate Storage
Storage --> Backend: 4. OK
deactivate Storage
Backend --> Frontend: 5. 200 {updated metadata}
deactivate Backend
Frontend -> Usuario: 6. Actualizar UI
deactivate Frontend
deactivate Usuario
@enduml
